/*!
 * jQuery cxCalendar
 * @name jquery.cxcalendar.js
 * @version 1.4.2
 * @date 2015-10-27
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxCalendar
 * @license Released under the MIT license
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){a.cxCalendar=function(){var b={dom:{},api:{}};return b.init=function(){var c,d,g,h,b=this,e=function(a){return a&&("function"==typeof HTMLElement||"object"==typeof HTMLElement)&&a instanceof HTMLElement?!0:a&&a.nodeType&&1===a.nodeType?!0:!1},f=function(a){return a&&a.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&a instanceof jQuery?!0:!1};for(g=0,h=arguments.length;h>g;g++)f(arguments[g])?b.dom.el=arguments[g]:e(arguments[g])?b.dom.el=a(arguments[g]):"function"==typeof arguments[g]?d=arguments[g]:"object"==typeof arguments[g]&&(c=arguments[g]);b.dom.el.length&&(b.settings=a.extend({},a.cxCalendar.defaults,c,{startDate:b.dom.el.data("startDate"),endDate:b.dom.el.data("endDate"),type:b.dom.el.data("type"),wday:b.dom.el.data("wday"),position:b.dom.el.data("position"),baseClass:b.dom.el.data("baseClass"),language:b.dom.el.data("language")}),b.isIE6=document.all&&!window.XMLHttpRequest,b.isIE8=!1,b.reg={isYear:/^\d{4}$/,isMonth:/^\d{1,2}$/,isDate:/^(\d+)[\.\-](\d+)[\.\-](\d+)$/},b.dom.el.val().length&&(b.settings.date=b.dom.el.val()),b.setOptions(),b.build(!0),b.api={show:function(){b.show()},hide:function(){b.hide()},getDate:function(){return b.getDate.apply(b,arguments)},setDate:function(){b.setDate.apply(b,arguments)},gotoDate:function(){b.gotoDate.apply(b,arguments)},clearDate:function(){b.clearDate()},setOptions:function(){b.setOptions.apply(b,arguments),b.build()}},"function"==typeof d&&d(b.api))},b.getLanguage=function(b){return"object"==typeof b?b:("string"==typeof b?b=b.toLowerCase():"string"==typeof navigator.language?b=navigator.language.toLowerCase():"string"==typeof navigator.browserLanguage&&(b=navigator.browserLanguage.toLowerCase()),"string"==typeof b&&"object"==typeof a.cxCalendar.languages[b]?a.cxCalendar.languages[b]:a.cxCalendar.languages["default"])},b.setOptions=function(b){var d,e,f,g,h,c=this;if("object"==typeof b&&a.extend(c.settings,b),d=c.reg.isYear.test(c.settings.startDate)?new Date(c.settings.startDate,0,1):new Date(c.getDateValue(c.settings.startDate)),e=c.reg.isYear.test(c.settings.endDate)?new Date(c.settings.endDate,11,31):new Date(c.getDateValue(c.settings.endDate)),(isNaN(d.getTime())||isNaN(e.getTime())||d.getFullYear()>e.getFullYear())&&(d=new Date(a.cxCalendar.defaults.startDate,0,1),e=new Date(a.cxCalendar.defaults.endDate,11,31)),c.minDate={year:d.getFullYear(),month:d.getMonth()+1,time:d.getTime()},c.maxDate={year:e.getFullYear(),month:e.getMonth()+1,time:e.getTime()},f=c.settings.date?new Date(c.getDateValue(c.settings.date)):new Date,isNaN(f.getTime())&&(f=new Date),c.defDate=f.getTime()<c.minDate.time?a.extend({},c.minDate):f.getTime()>c.maxDate.time?a.extend({},c.maxDate):{year:f.getFullYear(),month:f.getMonth()+1,time:f.getTime()},c.settings.saturday=6-c.settings.wday,c.settings.sunday=7-c.settings.wday>=7?0:7-c.settings.wday,c.language=c.getLanguage(c.settings.language),a.isArray(c.language.holiday)&&c.language.holiday.length)for(c.holiday={},g=0,h=c.language.holiday.length;h>g;g++)c.holiday[c.language.holiday[g].day]=c.language.holiday[g].name;else c.holiday=null},b.getMonthDays=function(a){var b=0===a%4&&0!==a%100||0===a%400?1:0;return[31,28+b,31,30,31,30,31,31,30,31,30,31]},b.getDateValue=function(a){var b=this;return b.reg.isYear.test(a)?a+="/1/1":"number"==typeof a&&isFinite(a)?a=parseInt(a,10):"string"==typeof a&&b.isIE8&&b.reg.isDate.test(a)&&(a=a.replace(/[\.\-]/g,"/")),a},b.formatDate=function(a,b){var c,d;return"string"!=typeof a||"undefined"===b?b:(b=this.getDateValue(b),c=new Date(b),d={},isNaN(c.getTime())?b:(d.yyyy=c.getFullYear(),d.yy=d.yyyy.toString(10).slice(-2),d.m=c.getMonth()+1,d.mm=d.m<10?"0"+d.m:d.m,d.d=c.getDate(),d.dd=d.d<10?"0"+d.d:d.d,d.time=c.getTime(),d.string=c.toDateString(),a=a.replace(/STRING/g,d.string),a=a.replace(/TIME/g,d.time),a=a.replace(/YYYY/g,d.yyyy),a=a.replace(/YY/g,d.yy),a=a.replace(/MM/g,d.mm),a=a.replace(/M/g,d.m),a=a.replace(/DD/g,d.dd),a=a.replace(/D/g,d.d)))},b.build=function(b){var d,e,c=this;for(b===!0&&(c.dom.pane=a("<div></div>",{"class":"cxcalendar"}),c.dom.paneHd=a("<div></div>",{"class":"cxcalendar_hd"}).appendTo(c.dom.pane),c.dom.paneBd=a("<div></div>",{"class":"cxcalendar_bd"}).appendTo(c.dom.pane),c.dom.paneHd.html('<a class="prev" href="javascript://" rel="prev"></a><a class="next" href="javascript://" rel="next"></a>'),c.dom.dateTxt=a("<div></div>",{"class":"intxt"}).appendTo(c.dom.paneHd),c.dom.dateSet=a("<div></div>",{"class":"inset"}).appendTo(c.dom.paneHd),c.dom.yearSet=a("<select></select>",{"class":"year"}).appendTo(c.dom.dateSet),c.dom.monthSet=a("<select></select>",{"class":"month"}).appendTo(c.dom.dateSet),c.dom.weekSet=a("<ul></ul>",{"class":"week"}).appendTo(c.dom.paneBd),c.dom.daySet=a("<ul></ul>",{"class":"days"}).appendTo(c.dom.paneBd)),d="",e=c.minDate.year;e<=c.maxDate.year;e++)d+='<option value="'+e+'">'+e+"</option>";for(c.dom.yearSet.html(d).val(c.defDate.year),d="",e=0;12>e;e++)d+='<option value="'+(e+1)+'">'+c.language.monthList[e]+"</option>";for(c.dom.monthSet.html(d).val(c.defDate.month),d="",e=0;7>e;e++)d+="<li",e===c.settings.saturday?d+=' class="sat"':e===c.settings.sunday&&(d+=' class="sun"'),d+=">",d+=e+c.settings.wday<7?c.language.weekList[e+c.settings.wday]:c.language.weekList[e+c.settings.wday-7],d+="</li>";c.dom.weekSet.html(d),"string"==typeof c.settings.baseClass&&c.dom.pane.attr("class","cxcalendar").addClass(c.settings.baseClass),c.gotoDate(c.defDate.year,c.defDate.month),b===!0&&(c.dom.pane.appendTo("body"),c.dom.blockBg=a("<div></div>",{"class":"cxcalendar_lock"}).appendTo("body"),c.bindEvents())},b.bindEvents=function(){var b=this;b.dom.el.on("focus",function(){b.show()}),b.dom.blockBg.on("click",function(){b.hide()}),b.dom.dateTxt.on("click",function(){b.dom.dateTxt.hide(),b.dom.dateSet.show()}),b.dom.yearSet.on("change",function(){b.gotoDate(b.dom.yearSet.val(),b.dom.monthSet.val())}),b.dom.monthSet.on("change",function(){b.gotoDate(b.dom.yearSet.val(),b.dom.monthSet.val())}),b.dom.pane.on("click","a",function(){switch(this.rel){case"prev":return b.gotoDate(b.dom.yearSet.val(),parseInt(b.dom.monthSet.val(),10)-1),!1;case"next":return b.gotoDate(b.dom.yearSet.val(),parseInt(b.dom.monthSet.val(),10)+1),!1}}),b.dom.daySet.on("click","li",function(){var c=a(this);c.hasClass("del")||b.setDate(c.data("year"),c.data("month"),c.data("day"))})},b.rebulidMonthSelect=function(a,b){var f,c=a||1,d=b||12,e="";for(f=c;d>=f;f++)e+='<option value="'+f+'">'+this.language.monthList[f-1]+"</option>";this.dom.monthSet.html(e)},b.show=function(){var a=this,b=a.settings.position,c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,d=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=a.dom.pane.outerWidth(),f=a.dom.pane.outerHeight(),g=a.dom.el.offset().top,h=a.dom.el.offset().left,i=a.dom.el.outerWidth(),j=a.dom.el.outerHeight(),k=g+f+j>d?g-f:g+j,l=h+e>c?h-e-i:h;if("string"==typeof b&&b.length)switch(b){case"top":k=g-f;break;case"topLeft":case"topRight":k=g-f,l="topLeft"===b?h-e+i:h;break;case"bottom":k=g+j;break;case"bottomLeft":case"bottomRight":k=g+j,l="bottomLeft"===b?h-e+i:h;break;case"left":case"right":k=g+f+j>d?g+j-f:g,l="left"===b?h-e:h+i;break;case"leftTop":case"leftBottom":k="leftTop"===b?g+j-f:g,l=h-e;break;case"rightTop":case"rightBottom":k="rightTop"===b?g+j-f:g,l=h+i}a.dom.dateTxt.html('<span class="y">'+a.dom.yearSet.val()+'</span><span class="m">'+a.language.monthList[parseInt(a.dom.monthSet.val(),10)-1]+"</span>"),a.dom.pane.css({top:k,left:l}).show(),a.isIE6&&a.dom.blockBg.css({width:c,height:d}),a.dom.blockBg.show()},b.hide=function(){var a=this;a.dom.pane.hide(),a.dom.blockBg.hide(),a.dom.dateSet.hide(),a.dom.dateTxt.show()},b.gotoDate=function(a,b){var d,e,f,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,c=this;if(d=c.reg.isYear.test(a)&&c.reg.isMonth.test(b)?new Date(a,b-1,1):new Date(c.getDateValue(a)),!isNaN(d.getTime())){for(e=d.getFullYear(),f=d.getMonth()+1,_theTime=d.getTime(),e<c.minDate.year||e<=c.minDate.year&&f<c.minDate.month?(e=c.minDate.year,f=c.minDate.month):(e>c.maxDate.year||e>=c.maxDate.year&&f>c.maxDate.month)&&(e=c.maxDate.year,f=c.maxDate.month),e===c.minDate.year&&e===c.maxDate.year?c.rebulidMonthSelect(c.minDate.month,c.maxDate.month):e===c.minDate.year?c.rebulidMonthSelect(c.minDate.month,12):e===c.maxDate.year?c.rebulidMonthSelect(1,c.maxDate.month):c.rebulidMonthSelect(),g=f-1,h=c.getMonthDays(e),i=new Date(e,g,1),new Date(e,f,1),k=new Date,l=k.getFullYear(),m=k.getMonth()+1,n=k.getDate(),o=c.dom.el.val(),o.length&&(o=c.getDateValue(o),p=new Date(o),isNaN(p.getTime())||(q=p.getFullYear(),r=p.getMonth()+1,s=p.getDate())),t=i.getDay()-c.settings.wday,0>t&&(t+=7),u=7*Math.ceil((h[g]+t)/7),B="",C=0;u>C;C++)A="",z=[],w=e,x=f,v=C-t+1,0>=v?(z.push("other"),1>=x?(w--,x=12,v=h[11]+v):(x--,v=h[g-1]+v)):v>h[g]&&(z.push("other"),x>=12?(w++,x=1,v-=h[0]):(x++,v-=h[g])),y=new Date(w,x-1,v).getTime(),"object"==typeof p&&w===q&&x===r&&v===s?z.push("selected"):w===l&&x===m&&v===n&&z.push("now"),C%7===c.settings.saturday?z.push("sat"):C%7===c.settings.sunday&&z.push("sun"),(y<c.minDate.time||y>c.maxDate.time)&&z.push("del"),A=w+"-"+x+"-"+v,c.holiday&&("string"==typeof c.holiday["M"+x+"-"+v]?(z.push("holiday"),A=c.holiday["M"+x+"-"+v]):"string"==typeof c.holiday["D"+w+"-"+x+"-"+v]&&(z.push("holiday"),A=c.holiday["D"+w+"-"+x+"-"+v])),B+="<li",z.length&&(B+=' class="'+z.join(" ")+'"'),B+=' title="'+A+'"',B+=' data-year="'+w+'" data-month="'+x+'" data-day="'+v+'">'+v+"</li>";c.dom.daySet.html(B),c.dom.dateTxt.html('<span class="y">'+e+'</span><span class="m">'+c.language.monthList[g]+"</span>"),c.dom.yearSet.val(e),c.dom.monthSet.val(f)}},b.getDate=function(a){var b=this.dom.el.val();return"string"==typeof a&&a.length||(a=this.settings.type),b=this.formatDate(a,b)},b.setDate=function(a,b,c){var e,f,g,h,d=this;e=d.reg.isYear.test(a)&&d.reg.isMonth.test(b)&&d.reg.isMonth.test(c)?new Date(a,b-1,c):new Date(a),isNaN(e.getTime())||(f=e.getFullYear(),g=e.getMonth()+1,_todayTime=e.getTime(),h=d.formatDate(d.settings.type,_todayTime),d.dom.el.val(h).trigger("change"),d.hide(),d.gotoDate(f,g))},b.clearDate=function(){this.dom.el.val(""),this.hide()},b.init.apply(b,arguments),this},a.cxCalendar.defaults={startDate:1950,endDate:2030,date:void 0,type:"YYYY-MM-DD",wday:0,position:void 0,baseClass:void 0,language:void 0},a.cxCalendar.languages={"default":{monthList:["1","2","3","4","5","6","7","8","9","10","11","12"],weekList:["日","一","二","三","四","五","六"],holiday:[]}},a.fn.cxCalendar=function(b,c){return this.each(function(){a.cxCalendar(this,b,c)}),this}});